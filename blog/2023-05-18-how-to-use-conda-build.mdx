---
title: "How to use conda-build to build a python package with C/C++ dependency"
slug: "2023-05-18-how-to-use-conda-build.md"
authors: [vasvi]
tags: [conda]
image: img/blog/2023-02-01-matrix/conda-community-space-matrix.png
description: "We are pleased to announce that the conda community has migrated our chat rooms to the Matrix/Element platform."
---
import Image from '@theme/IdealImage';
import condabuild from '@site/static/img/blog/2023-05-18-how-to-use-conda-build.md/conda-build.png';

<Image img={condabuild} />

<hr />
Conda-build is a conda package that automates the process of building and distributing python packages. It is a powerful tool that automates the process of building and distributing Python packages with the added advantage of handling dependencies that require C/C++ or other languages. This is particularly useful for scientific computing, where many Python packages have complex dependencies and require specialized libraries and tools.

Conda-build creates a "recipe" that outlines the steps needed to build a package from source code. This recipe includes all the information from downloading and installing dependencies to compiling the source code and creating the final package. A recipe typically includes:

<ol>
<li>A script that contains metadata.</li>
<li>The script that installs the files for the package on macOS and Linux.</li>
<li>The build script that installs the files for the package on Windows.</li>
<li>Any additional setup files depending on the complexity of the package.</li>
</ol>

In this article, we will guide you through the process of building your python package with conda-build! Conda-build can help us handle even the most complex dependencies for our package, making the process smoother and more efficient. Let's get ready to build an amazing Python package!

## Getting Started 

### Prerequisites
Let's start building our own Python package. First, you need to ensure that you have installed <a href="https://docs.anaconda.com/anaconda/install/">Miniconda or Anaconda</a>. Conda-build is a package manager that can be installed using either of the two package managers.



### Installing conda-build
 Create a new [conda environment](https://docs.conda.io/projects/conda/en/latest/user-guide/concepts/environments.html) and run the following command on your terminal :
```bash
conda install conda-build
```

### Creating a template for the recipe
For this tutorial, we'll be walking you through the process of building a recipe for PyPi's "click" package. Pypi is among the various repositories available for python softwares on the internet. 
```bash
conda skeleton pypi click
```
:::note

Use can use any package available from PyPi instead of click

:::


After executing this command, a new directory called "click" will be generated. Inside this directory, you'll find a file named "meta.yaml". This file contains all the metadata necessary to create a conda package, such as the package name, version number, source code address, installation instructions, dependencies, hosting location, license, and more. Note that if you didn't use the "skeleton" command, you'll need to manually write the script yourself. You can make  any changes to meta.yaml file and be the maintainer and distributor of your package.


## Building the package
Run this command from the root folder :
```bash
conda-build click
```

After the build process is finished,  conda-build will generate a package file in the 'conda-bld' directory.
To locate this  file, you can use this command from the terminal:
```bash 
conda build click --output
```
You can now install the package locally by running this command in the terminal.
```bash 
 conda install --use-local click
 ```
 Congrats ðŸŽŠðŸŽ‰, you have successfully downloaded your own package! You can modify this package and upload it to Anaconda cloud.

### Building a package with C/C++ dependency
With conda-build, it is extremely simple to include non-python packages.

In the "meta.yaml" file you can include the following and build the package again:
```bash
script: 
    g++ -o mylib.so -shared -fPIC mylib.cpp

requirements:
  build:
    - gcc  
 run:
    - mylib 
 ```   

In this example, we have added gcc as a build dependency, and mylib as a runtime dependency. We have also added a new step to compile mylib.cpp into a shared library called mylib.so.

## Testing the package
After successfully creating our package, we can now proceed to create another conda environment on our machine and use the newly created package. Additionally, we can also upload the package to Anaconda Cloud and distribute it to others or create our channel.

To install the package on your local machine, use the following command:

```bash
conda create -n test_env
conda activate test_env
conda install click
```

You can also upload your package to any existing channel and distribute it to others. You can also create your own channel.
```bash
anaconda upload /path/to/my_package-1.0-0.tar.bz2
```

## Conclusion
In conclusion, using conda-build to create and manage Python packages can simplify the process of distribution and installation of software packages. With conda-build, you don't have to reinvent the wheel or write code from scratch - instead, you can rely on pre-built packages and easily integrate any non-Python dependencies into your projects. Conda-build can be used as a one-stop solution for all your package management needs. 















